{const a=(a)=>a!==void 0,b=(a)=>a&&a.constructor===Object,c=(a)=>(...b)=>new a(...b),d=c(Map),e=c(Set),f=c(Proxy),g=c(Promise),h=(b=d())=>Object.assign((c,d)=>a(d)?(b.has(c)?b:b.set(c,e())).get(c).add(d):b.get(c),{map:b,del(a,c){b.has(a)&&1>b.get(a).delete(c).size&&b.delete(a)},has(c,d){const e=b.get(c);return a(d)?e&&e.has(d):!!e},each(a,c){b.has(a)&&b.get(a).forEach(c)}}),i=(a,b=!0)=>f(a,{get(c,d){return b&&Reflect.has(a,d)?Reflect.get(a,d):a.bind(null,d)}}),j=(a,...b)=>g((c,d)=>{try{c(a(...b))}catch(a){d(a)}}),k=(a,...b)=>(b.forEach((b)=>{a=Object.assign(a,b)}),a),l=()=>{const a=h(),c=(b,c)=>(c.off=()=>a.del(b,c),c.once=()=>(c.off(),g(b,c)),c.on=()=>(c.off(),f(b,c)),c),d=(a,b)=>{for(const c in a)a[c]=e(c,a[c],b);return a},e=(e,f,g)=>{function h(){return g&&a.del(e,h),f(...arguments)}return b(e)?d(e,g):(a(e,h),c(e,h))},f=i(e),g=i((a,b)=>e(a,b,!0)),k=i((b,...c)=>{a.each(b,(a)=>a(...c))},!1),l=i((b,...c)=>{j(a.each,b,(a)=>j(a,...c))},!1);return{emit:k,emitAsync:l,on:f,once:g,listen:e,listeners:a}},m=(a,b={})=>(a.forEach((a,c)=>{b[c]=a}),JSON.stringify(b));var SuperModel=(c={},e=d())=>{const h=l(),{emit:i,emitAsync:j,on:n,once:o}=h,p=(a)=>{e.delete(a),i('delete',a),i('delete:'+a)},q=(a)=>e.has(a),r=(a,c,d)=>{if(b(a)){for(let b in a)r(b,a[b],c);return r}const f=e.get(a);return void 0!==c&&c!==f?(e.set(a,c),d||(i('set',a,c),i('set:'+a,c)),r):(d||(i('get',a),i('get:'+a)),f)};r(c);const s=d(),t=(a,b,c=b)=>(s.has(a)||s.set(a,d()),s.get(a).set(c,n('set:'+c,(c)=>{a[b]=c})),q(c)&&(a[b]=e.get(c)),a);t.stop=(a,b)=>{if(q(a)){const c=s.get(a);b?c.has(b)&&(c.get(b).off(),c.delete(b)):c.forEach((a)=>a.off()).clear(),c.size||s.delete(a)}return a};const u=f((a,b)=>{q(a)?b(e.get(a)):o('set:'+a,b)},{get:(a,b)=>g((a)=>{q(b)?a(e.get(b)):o('set:'+b,a)}),set:(a,b,c)=>c.then((a)=>r(b,a))}),v=d(),w=(a)=>{const b=e.has(a)&&v.has(a)&&v.get(a)(e.get(a));return j('validate:'+a,b),j('validate',a,b),b},x=f((b,c)=>{if(!a(c))return w(b);if(c instanceof RegExp){const a=c;c=(b)=>'string'==typeof b&&a.test(b)}c instanceof Function&&v.set(b,c)},{get:(a,b)=>w(b),set:(a,b,c)=>a(b,c)});return f(k(r,{has:q,store:e,sync:t,syncs:s,del:p,toJSON:()=>m(e)},h),{get(a,b){if(Reflect.has(a,b))return Reflect.get(a,b);return'async'===b?u:'valid'===b?x:r(b)},set(a,b,c){return c&&c.constructor===Promise?u[b]=c:r(b,c)},delete:(a,b)=>p(b)})};SuperModel.runAsync=j,SuperModel.listMap=h,SuperModel.emitter=l}