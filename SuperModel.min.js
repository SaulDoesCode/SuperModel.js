{const a=(a)=>a&&a.constructor===Object,b=(a)=>(...b)=>new a(...b),c=b(Map),d=b(Set),e=b(Proxy),f=b(Promise),g=(a=c(),b={get:(b)=>a.get(b),set(c,e){return(a.has(c)?a:a.set(c,d())).get(c).add(e),b},del(c,d){return a.has(c)&&1>a.get(c).delete(d).size&&a.delete(c),b},has(b,c){const d=a.has(b);return c!==void 0&&d?a.get(b).has(c):d},each(c,d){return b.has(c)&&a.get(c).forEach(d),b}})=>b,h=(a,b=!0)=>e(a,{get(c,d){return b&&Reflect.has(a,d)?Reflect.get(a,d):a.bind(null,d)}}),i=(a,...b)=>f((c,d)=>{try{c(a(...b))}catch(a){d(a)}}),j=(a,...b)=>(b.forEach((b)=>{a=Object.assign(a,b)}),a),k=()=>{const b=g(),c=(a,c)=>(c.off=()=>b.del(a,c),c.once=()=>(c.off(),f(a,c)),c.on=()=>(c.off(),e(a,c)),c),d=(a,b)=>{for(let c in a)a[c]=b(a[c])},e=h((f,g)=>a(f)?d(f,e):(b.set(f,g),c(f,g))),f=h((e,g)=>{if(a(e))return d(e,f);const h=(...a)=>(b.del(e,h),g(...a));return b.set(e,h),c(e,h)}),j=h((a,...c)=>{b.each(a,(a)=>a(...c))},!1),k=h((a,...c)=>{i(b.each,a,(a)=>i(a,...c))},!1);return{emit:j,emitAsync:k,on:e,once:f,listen:(a,b,c)=>(a?f:e)(b,c)}},l=(a,b={})=>(a.forEach((a,c)=>b[c]=a),JSON.stringify(b));var SuperModel=(b={},d=c())=>{const g=k(),{emit:h,emitAsync:i,on:m,once:n,listen:o}=g,p=(a)=>{d.delete(a),h('delete',a),h('delete:'+a)},q=(a)=>d.has(a),r=(b,c,e)=>{if(a(b)){for(let a in b)r(a,b[a],c);return r}const f=d.get(b);return void 0!==c&&c!==f?(d.set(b,c),e||(h('set',b,c),h('set:'+b,c)),r):(e||(h('get',b),h('get:'+b)),f)};r(b);const s=c(),t=(a,b,e=b)=>(s.has(a)||s.set(a,c()),s.get(a).set(e,m('set:'+e,(c)=>{a[b]=c})),q(e)&&(a[b]=d.get(e)),a);t.stop=(a,b)=>{if(q(a)){const c=s.get(a);b?c.has(b)&&(c.get(b).off(),c.delete(b)):c.forEach((a)=>a.off()).clear(),c.size||s.delete(a)}return a};const u=e((a,b)=>{q(a)?b(d.get(a)):n('set:'+a,b)},{get:(a,b)=>f((a)=>{q(b)?a(d.get(b)):n('set:'+b,a)}),set(a,b,c){c.then(r.bind(null,b))}}),v=c(),w=(a)=>{const b=d.has(a)&&v.has(a)&&v.get(a)(d.get(a));return i('validate:'+a,b),i('validate',a,b),b},x=e((a,b)=>{if(b===void 0)return w(a);if(b instanceof RegExp){const a=b;b=(b)=>'string'==typeof b&&a.test(b)}b instanceof Function&&v.set(a,b)},{get:(a,b)=>w(b),set:(a,b,c)=>a(b,c)});return e(j(r,{has:q,store:d,sync:t,syncs:s,del:p,toJSON:()=>l(d)},g),{get(a,b){if(Reflect.has(a,b))return Reflect.get(a,b);return'async'===b?u:'valid'===b?x:r(b)},set(a,b,c){return c&&c.constructor===Promise?u[b]=c:r(b,c)},delete:(a,b)=>p(b)})};SuperModel.runAsync=i,SuperModel.listMap=g,SuperModel.emitter=k}