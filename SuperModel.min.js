{const a=(a)=>a!==void 0,b=(a)=>a&&a.constructor===Object,c=(a)=>(...b)=>new a(...b),d=c(Map),e=c(Set),f=c(Proxy),g=c(Promise),h=(b=d())=>Object.assign((c,d)=>a(d)?(b.has(c)?b:b.set(c,e())).get(c).add(d):b.get(c),{map:b,del(a,c){b.has(a)&&1>b.get(a).delete(c).size&&b.delete(a)},has(c,d){const e=b.get(c);return a(d)?e&&e.has(d):!!e},each(a,c){b.has(a)&&b.get(a).forEach(c)}}),i=(a,b=!0)=>f(a,{get(c,d){return b&&Reflect.has(a,d)?Reflect.get(a,d):a.bind(null,d)}}),j=(a,...b)=>g((c,d)=>{try{c(a(...b))}catch(a){d(a)}}),k=(a,...b)=>(b.forEach((b)=>{a=Object.assign(a,b)}),a),l=(a={})=>{const c=h(),d=(a,b)=>{for(const c in a)a[c]=e(c,a[c],b);return a},e=(a,e,f=!1)=>{if(b(a))return d(a,f);const g=(...a)=>e(...a),h=(b)=>(c.del(a,g),g.once=b,c(a,g),g);return g.off=()=>(c.del(a,g),g),g.on=()=>h(!1),g.once=()=>h(!0),h(f)},f=i((a,b)=>e(a,b)),g=i((a,b)=>e(a,b,!0)),l=i((a,...b)=>{c.each(a,(a)=>{j(a,...b),a.once&&a.off()})},!1);return k(a,{emit:l,on:f,once:g,listen:e,listeners:c})},m=(a,b={})=>(a.forEach((a,c)=>{b[c]=a}),JSON.stringify(b));var SuperModel=(c={},e=d())=>{const h=l(),{emit:i,on:j,once:n}=h,o=(a)=>{e.delete(a),i('delete',a),i('delete:'+a)},p=(a)=>e.has(a),q=(c,d,f)=>{if(b(c)){for(let a in c)q(a,c[a],d);return q}const g=e.get(c);return a(d)&&d!==g?(e.set(c,d),f||(i('set',c,d),i('set:'+c,d)),q):(f||(i('get',c),i('get:'+c)),g)};q(c);const r=d(),s=(a,b,c=b)=>(r.has(a)||r.set(a,d()),r.get(a).set(c,j('set:'+c,(c)=>{a[b]=c})),p(c)&&(a[b]=e.get(c)),a);s.stop=(a,b)=>{if(p(a)){const c=r.get(a);b?c.has(b)&&(c.get(b).off(),c.delete(b)):c.forEach((a)=>a.off()).clear(),c.size||r.delete(a)}return a};const t=f((a,b)=>{p(a)?b(e.get(a)):n('set:'+a,b)},{get:(a,b)=>g((a)=>{p(b)?a(e.get(b)):n('set:'+b,a)}),set:(a,b,c)=>c.then((a)=>q(b,a))}),u=d(),v=(a)=>{const b=e.has(a)&&u.has(a)&&u.get(a)(e.get(a));return i('validate:'+a,b),i('validate',a,b),b},w=f((b,c)=>{if(!a(c))return v(b);if(c instanceof RegExp){const a=c;c=(b)=>'string'==typeof b&&a.test(b)}c instanceof Function&&u.set(b,c)},{get:(a,b)=>v(b),set:(a,b,c)=>a(b,c)});return f(k(q,{has:p,store:e,sync:s,syncs:r,del:o,toJSON:()=>m(e)},h),{get(a,b){if(Reflect.has(a,b))return Reflect.get(a,b);return'async'===b?t:'valid'===b?w:q(b)},set:(a,b,c)=>c&&c.constructor===Promise?t[b]=c:q(b,c),delete:(a,b)=>o(b)})};SuperModel.runAsync=j,SuperModel.listMap=h,SuperModel.emitter=l}