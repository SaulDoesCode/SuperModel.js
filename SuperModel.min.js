{const a=(a,b=!1)=>new Proxy(a,{get:(a,c)=>b&&c in a&&Reflect.get(a,c)||a.bind(void 0,c)}),b=(b={},c=new Map)=>Object.assign(b,{listeners:c,emit:a((a,...b)=>{if(c.has(a))for(const d of c.get(a))d.apply(void 0,b)}),emitAsync:a((a,...b)=>{c.has(a)&&setTimeout(()=>{for(const d of c.get(a))setTimeout(()=>{d.apply(void 0,b)},0)})}),on:a((a,d)=>(c.has(a)||c.set(a,new Set),c.get(a).add(d),()=>b.off(a,d))),once:a((a,c)=>b.on(a,function d(){c(...arguments),b.off(a,d)})),off:a((a,b)=>{if(c.has(a)){const d=c.get(a);d.delete(b),d.size||c.delete(a)}})}),c=Array.isArray,d=(a)=>a!==void 0&&null!==a,e=(a)=>a===void 0||null===a,f=(a)=>a&&a.constructor===Object,g=(a)=>'string'==typeof a,h=(a)=>a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement,i=(a)=>c(a)||a instanceof NodeList||d(a)&&!(a instanceof Function||a instanceof Node)&&0==a.length%1,j=(a)=>'object'==typeof a&&l(a.then),k=(a)=>a instanceof RegExp,l=(a)=>a instanceof Function,m=(a,b)=>{if(i(a)){const c=l(b);for(let d=0;d<a.length;d++)if(c?!b(a[d]):a[d]!==b)return!1;return!0}return!1},n=(a,b=[],d=!0)=>{if(d&&!c(a))return[a];for(var e=0;e<a.length;e++)c(a[e])?n(a[e],b):b.push(a[e]);return b},o=(a,b={})=>(a.forEach((a,c)=>{b[c]=a}),JSON.stringify(b));var SuperModel=(a,i=b(),p=new Map)=>{function q(a,b){if(g(b)&&m(arguments,g))for(var c=0;c<arguments.length;c++)q(arguments[c],b);else p.delete(a),b||(s('delete',a),s('delete:'+a));return x}let r;const{emit:s,emitAsync:t,on:u,once:v}=i,w=(a)=>p.has(a),x=(a,b,g)=>{if('string'==typeof a){const c=p.get(a);return d(b)&&b!==c?(p.set(a,b),g||(s('set',a,b),s('set:'+a,b)),b):(g||(s('get',a),s('get:'+a)),c)}if(f(a))for(const c in a)e(a[c])?q(c,b):x(c,a[c],b);else if(c(a))for(var h=0;h<a.length;h++)x(a[h][0],a[h][1],b);return r},y=new Map,z=new Proxy(function(a,b,d=b){if(c(a)){const b=Array.from(arguments).slice(1);if(b.every(g))return z.template(a,...b)}let e=h(a)||a.isContentEditable;e&&([d,b]=[b,a.isContentEditable?'innerText':'value']),y.has(a)||y.set(a,new Map);let f='set';if(d.includes(':')){[f,d]=d.split(':');var i='valid'===f,j='compute'===f;i&&(f='validate')}if(y.get(a).set(d,u(f+':'+d,(c)=>{e&&a[b].trim()===c||(a[b]=c)})),!i&&e){const c=()=>{x(d,a[b].trim()),B.has(d)&&C(d)};w(d)||c(),a.addEventListener('input',c);var k=()=>a.removeEventListener('input',c)}return i?a[b]=C(d):j&&E.has(d)?a[b]=F(d):w(d)&&(a[b]=x(d)),v('delete:'+d,()=>{k&&k(),z.stop(a,d)}),a},{get(a,b){return Reflect.has(a,b)?Reflect.get(a,b):(c,d)=>e(c)?z.text(b):(e(d)&&(d=b),a(c,d,b))}});z.stop=(a,b)=>{if(w(a)){const c=y.get(a);b?c.has(b)&&(c.get(b).off(),c.delete(b)):c.forEach((a)=>a.off()).clear(),c.size||y.delete(a)}return a},z.text=new Proxy((a)=>z(new Text,'textContent',a),{get:(a,b)=>a(b)}),z.template=(a,...b)=>n(b.reduce((b,c,d)=>[b,z.text(c),a[d+1]],a[0]).filter((a)=>!g(a)||a.length));const A=new Proxy((a,b)=>w(a)?b(p.get(a)):v('set:'+a,b),{get:(a,b)=>new Promise((a)=>{w(b)?a(p.get(b)):v('set:'+b,a)}),set:(a,b,c)=>c.then(x.bind(void 0,b))}),B=new Map,C=(a)=>{const b=p.has(a)&&B.has(a)&&B.get(a)(p.get(a));return s('validate:'+a,b),s('validate',a,b),b},D=new Proxy((a,b)=>{if(e(b))return C(a);if(k(b)){const a=b;b=(b)=>g(b)&&a.test(b)}if(l(b)){if('boolean'!=typeof b())throw new Error(`".${a}": validator invalid`);B.set(a,b)}},{get:(a,b)=>C(b),set:(a,b,c)=>a(b,c)}),E=new Map,F=new Proxy(function(a,b){if(l(b))E.set(a,b);else if(g(b)&&m(arguments,g)){const a={};for(let b=0;b<arguments.length;b++)a[arguments[b]]=F(arguments[b]);return a}if(E.has(a)){const b=E.get(a),c=b(r);return b.result!==c&&(t('compute:'+a,c),t('compute',a,c),b.result=c),c}if(f(a))for(const b of a)F(b,a[b])},{get:(a,b)=>a(b),set:(a,b,c)=>a(b,c)}),G=()=>Array.from(p.entries());if(g(a))try{x(JSON.parse(a),!0)}catch(a){}else d(a)&&x(a,!0);return r=new Proxy(Object.assign(x,i,{compute:F,async:A,valid:D,each:(a)=>(p.forEach(a),r),has:w,del:q,map:(a)=>(p.forEach((b,c)=>{const d=a(b,c);e(d)||d===b||p.set(c,b)}),r),filter:(a)=>(p.forEach((b,c)=>{a(b,c)||p.delete(c)}),r),store:p,sync:z,syncs:y,toJSON:()=>o(p),toArray:G,toJSONArray:()=>JSON.stringify(G())}),{get:(a,b)=>Reflect.has(a,b)?a[b]:'size'===b?p.size:x(b),set:(a,b,c)=>j(c)?A(b,c):x(b,c),delete:(a,b)=>q(b)}),r};SuperModel.emitter=b}