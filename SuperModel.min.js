{const a=(a)=>a&&a.constructor===Object,b=(a)=>(...b)=>new a(...b),c=b(Map),d=b(Set),e=b(Proxy),f=b(Promise),g=(a=c(),b={get:(b)=>a.get(b),set(c,e){return(a.has(c)?a:a.set(c,d())).get(c).add(e),b},del(c,d){return a.has(c)&&1>a.get(c).delete(d).size&&a.delete(c),b},has(b,c){const d=a.has(b);return c!==void 0&&d?a.get(b).has(c):d},each(c,d){return b.has(c)&&a.get(c).forEach(d),b}})=>b,h=(a,b=!0)=>e(a,{get(c,d){return b&&Reflect.has(a,d)?Reflect.get(a,d):a.bind(null,d)}}),i=(a,...b)=>f((c,d)=>{try{c(a(...b))}catch(a){d(a)}}),j=(a,...b)=>(b.forEach((b)=>{a=Object.assign(a,b)}),a),k=()=>{const b=g(),c=(a,c)=>(c.off=()=>b.del(a,c),c.once=()=>(c.off(),f(a,c)),c.on=()=>(c.off(),e(a,c)),c),d=(a,b)=>{for(let c in a)a[c]=b(a[c])},e=h((f,g)=>a(f)?d(f,e):(b.set(f,g),c(f,g))),f=h((e,g)=>{if(a(e))return d(e,f);const h=(...a)=>(b.del(e,h),g(...a));return b.set(e,h),c(e,h)}),j=h((a,...c)=>{b.each(a,(a)=>a(...c))},!1),k=h((a,...c)=>{i(b.each,a,(a)=>i(a,...c))},!1);return{emit:j,emitAsync:k,on:e,once:f,listen:(a,b,c)=>(a?f:e)(b,c)}},l=(a,b={})=>(a.forEach((a,c)=>{b[c]=a}),JSON.stringify(b));var SuperModel=(b={},d=c())=>{const g=k(),{emit:h,emitAsync:i,on:m,once:n}=g,o=(a)=>{d.delete(a),h('delete',a),h('delete:'+a)},p=(a)=>d.has(a),q=(b,c,e)=>{if(a(b)){for(let a in b)q(a,b[a],c);return q}const f=d.get(b);return void 0!==c&&c!==f?(d.set(b,c),e||(h('set',b,c),h('set:'+b,c)),q):(e||(h('get',b),h('get:'+b)),f)};q(b);const r=c(),s=(a,b,e=b)=>(r.has(a)||r.set(a,c()),r.get(a).set(e,m('set:'+e,(c)=>{a[b]=c})),p(e)&&(a[b]=d.get(e)),a);s.stop=(a,b)=>{if(p(a)){const c=r.get(a);b?c.has(b)&&(c.get(b).off(),c.delete(b)):c.forEach((a)=>a.off()).clear(),c.size||r.delete(a)}return a};const t=e((a,b)=>{p(a)?b(d.get(a)):n('set:'+a,b)},{get:(a,b)=>f((a)=>{p(b)?a(d.get(b)):n('set:'+b,a)}),set(a,b,c){c.then(q.bind(null,b))}}),u=c(),v=(a)=>{const b=d.has(a)&&u.has(a)&&u.get(a)(d.get(a));return i('validate:'+a,b),i('validate',a,b),b},w=e((a,b)=>{if(b===void 0)return v(a);if(b instanceof RegExp){const a=b;b=(b)=>'string'==typeof b&&a.test(b)}b instanceof Function&&u.set(a,b)},{get:(a,b)=>v(b),set:(a,b,c)=>a(b,c)});return e(j(q,{has:p,store:d,sync:s,syncs:r,del:o,toJSON:()=>l(d)},g),{get(a,b){if(Reflect.has(a,b))return Reflect.get(a,b);return'async'===b?t:'valid'===b?w:q(b)},set(a,b,c){return c&&c.constructor===Promise?t[b]=c:q(b,c)},delete:(a,b)=>o(b)})};SuperModel.runAsync=i,SuperModel.listMap=g,SuperModel.emitter=k}