{const a=(a,b=!1)=>new Proxy(a,{get:(a,c)=>'symbol'!=typeof c&&(b&&c in a&&Reflect.get(a,c)||a.bind(void 0,c))}),b=(b={},c=new Map)=>Object.assign(b,{listeners:c,emit:a((a,...b)=>{if(c.has(a))for(const d of c.get(a))d.apply(void 0,b)}),emitAsync:a((a,...b)=>{c.has(a)&&setTimeout(()=>{for(const d of c.get(a))setTimeout(()=>{d.apply(void 0,b)},0)})}),on:a((a,d)=>(c.has(a)||c.set(a,new Set),c.get(a).add(d),()=>b.off(a,d))),once:a((a,c)=>b.on(a,function d(){c(...arguments),b.off(a,d)})),off:a((a,b)=>{if(c.has(a)){const d=c.get(a);d.delete(b),d.size||c.delete(a)}})}),c='object'==typeof global,d=c?global:window,e=(a)=>'symbol'==typeof a?a.toString():a;if(c)var Text=class{constructor(a){this.textContent=a}};const f=Array.isArray,g=(a)=>a!==void 0&&null!==a,h=(a)=>a===void 0||null===a,j=(a)=>a&&a.constructor===Object,k=(a)=>'string'==typeof a,i=(a)=>!c&&(a instanceof d.HTMLInputElement||a instanceof d.HTMLTextAreaElement),l=(a)=>f(a)||!c&&a instanceof d.NodeList||g(a)&&!(a instanceof Function||!c&&a instanceof d.Node)&&0==a.length%1,m=(a)=>'object'==typeof a&&p(a.then),n=(a)=>a instanceof RegExp,p=(a)=>a instanceof Function,o=(a,b)=>{if(l(a)){const c=p(b);for(let d=0;d<a.length;d++)if(c?!b(a[d]):a[d]!==b)return!1;return!0}return!1},q=(a,b=[],c=!0)=>{if(c&&!f(a))return[a];for(var d=0;d<a.length;d++)f(a[d])?q(a[d],b):b.push(a[d]);return b},r=(a,b={})=>(a.forEach((a,c)=>{b[c]=a}),JSON.stringify(b)),s=(a,c=b(),d=new Map)=>{function l(a,b){if(k(b)&&o(arguments,k))for(var c=0;c<arguments.length;c++)l(arguments[c],b);else d.delete(a),b||(t('delete',a),t('delete:'+a));return y}let s;const{emit:t,emitAsync:u,on:v,once:w}=c,x=(a)=>d.has(a),y=(a,b,c)=>{if('string'==typeof a){const e=d.get(a);return g(b)&&b!==e?(d.set(a,b),c||(t('set',a,b),t('set:'+a,b)),b):(c||(t('get',a),t('get:'+a)),e)}if(j(a))for(const c in a)h(a[c])?l(c,b):y(c,a[c],b);else if(f(a))for(var e=0;e<a.length;e++)y(a[e][0],a[e][1],b);return s},z=new Map,A=new Proxy(function(a,b,c=b){if(b=e(b),c=e(c),f(a)){const b=Array.from(arguments).slice(1);if(b.every(k))return A.template(a,...b)}let d=i(a)||a.isContentEditable;d&&([c,b]=[b,a.isContentEditable?'innerText':'value']),z.has(a)||z.set(a,new Map);let g='set';if(c.includes(':')){[g,c]=c.split(':');var h='valid'===g,j='compute'===g;h&&(g='validate')}if(z.get(a).set(c,v(g+':'+c,(c)=>{d&&a[b].trim()===c||(a[b]=c)})),!h&&d){const d=()=>{y(c,a[b].trim()),C.has(c)&&D(c)};x(c)||d(),a.addEventListener('input',d);var l=()=>a.removeEventListener('input',d)}return h?a[b]=D(c):j&&F.has(c)?a[b]=G(c):x(c)&&(a[b]=y(c)),w('delete:'+c,()=>{l&&l(),A.stop(a,c)}),a},{get(a,b){return Reflect.has(a,b)?Reflect.get(a,b):(c,d)=>h(c)?A.text(b):(h(d)&&(d=b),a(c,d,b))}});A.stop=(a,b)=>{if(x(a)){const c=z.get(a);b?c.has(b)&&(c.get(b).off(),c.delete(b)):c.forEach((a)=>a.off()).clear(),c.size||z.delete(a)}return a},A.text=new Proxy((a)=>A(new Text,'textContent',a),{get:(a,b)=>a(e(b))}),A.template=(a,...b)=>q(b.reduce((b,c,d)=>[b,A.text(c),a[d+1]],a[0]).filter((a)=>!k(a)||a.length));const B=new Proxy((a,b)=>x(a)?b(d.get(a)):w('set:'+a,b),{get:(a,b)=>new Promise((a)=>{b=e(b),x(b)?a(d.get(b)):w('set:'+b,a)}),set:(a,b,c)=>c.then(y.bind(void 0,b))}),C=new Map,D=(a)=>{a=e(a);const b=d.has(a)&&C.has(a)&&C.get(a)(d.get(a));return t('validate:'+a,b),t('validate',a,b),b},E=new Proxy((a,b)=>{if(h(b))return D(a);if(a=e(a),n(b)){const a=b;b=(b)=>k(b)&&a.test(b)}if(p(b)){if('boolean'!=typeof b())throw new Error(`".${a}": validator invalid`);C.set(a,b)}},{get:(a,b)=>D(b),set:(a,b,c)=>a(b,c)}),F=new Map,G=new Proxy(function(a,b){if(a=e(a),p(b))F.set(a,b);else if(k(b)&&o(arguments,k)){const a={};for(let b=0;b<arguments.length;b++)a[arguments[b]]=G(arguments[b]);return a}if(F.has(a)){const b=F.get(a),c=b(s);return b.result!==c&&(u('compute:'+a,c),u('compute',a,c),b.result=c),c}if(j(a))for(const b of a)G(b,a[b])},{get:(a,b)=>a(b),set:(a,b,c)=>a(b,c)}),H=()=>Array.from(d.entries());if(k(a))try{y(JSON.parse(a),!0)}catch(a){}else g(a)&&y(a,!0);return s=new Proxy(Object.assign(y,c,{compute:G,async:B,valid:E,each:(a)=>(d.forEach(a),s),has:x,del:l,map:(a)=>(d.forEach((b,c)=>{const e=a(b,c);h(e)||e===b||d.set(c,b)}),s),filter:(a)=>(d.forEach((b,c)=>{a(b,c)||d.delete(c)}),s),store:d,sync:A,syncs:z,toJSON:()=>r(d),toArray:H,toJSONArray:()=>JSON.stringify(H())}),{get:(a,b)=>Reflect.has(a,b)?a[b]:'size'===b?d.size:y(b),set:(a,b,c)=>m(c)?B(b,c):y(b,c),delete:(a,b)=>l(b)}),s};s.emitter=b,p(d.define)&&d.define.amd?d.define([],()=>s):'object'==typeof module&&module.exports?module.exports=s:d.SuperModel=s}